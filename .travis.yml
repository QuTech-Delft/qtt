language: python

cache: pip

matrix:
  include:
  - name: Full installation 3.10
    python: 3.10.1
    sudo: true
    dist: focal
#    env: QT_QPA_PLATFORM=offscreen
    env: FULL_INSTALL=1
    services:
    - xvfb


install:
  - sudo apt-get install libhdf5-dev
  - pip install coveralls
  - pip install --upgrade pip pytest
  - pip install -e .
  - export QT_QPA_PLATFORM=offscreen
script:
  - pip freeze
  - pytest --version
  - xvfb-run -a coverage run --source="./src/qtt" -m pytest
  - mypy src --ignore-missing-imports
  - if [[ "$FULL_INSTALL" == "1" ]]; then
      jupyter --version;
      bash docs/notebooks/select_notebooks_to_execute.sh;
    fi
  - python docs/notebooks/qtt_example.py
after_success:
  - coveralls
