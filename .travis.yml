language: python
cache: pip


matrix:
  include:
  - name: "Minimal install"
    python: "3.6"
    env: DO_NOTEBOOKS=0 FULL_INSTALL=0
  - name: "Full install"
    python: "3.6"
    env: DO_NOTEBOOKS=1 FULL_INSTALL=1
#  - name: "Full install python 3.7"
#    python: "3.7"
#    env: MINIMAL_INSTALL=0
    
#python:
#    - "3.6"

#branches:
#  only:
#    - master
#    - dev

# command to install dependencies
install:
#    - pip install ipython
    - pip install -r requirements.txt
    - echo "FULL_INSTALL $FULL_INSTALL"
    - echo $DO_NOTEBOOKS
    - export MYVAR=2
    - echo "myvar $MYVAR"
    - env $FULL_INSTALL && "pip install -r develop_requirements.txt"
    - $FULL_INSTALL && pip install opencv-python
    #- pip install nbsphinx
#    - python setup.py install # gives issues with pytest
    - python setup.py develop
# command to run tests

#before_script:
    # see https://docs.travis-ci.com/user/gui-and-headless-browsers/#using-xvfb-to-run-tests-that-require-a-gui
    #- "export DISPLAY=:99.0"
    #- "sh -e /etc/init.d/xvfb start"
    #- sleep 3 # give xvfb some time to start
  
script: 
    - ls
    - pytest --version
    - xvfb-run -a pytest -v 
    - jupyter --version
    # run notebooks
    - env $DO_NOTEBOOKS jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_anticrossing.ipynb
    - $DO_NOTEBOOKS && jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_awg_to_plunger.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_charge_sensor.ipynb
    - xvfb-run jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_coulomb_peak.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_doublegauss_expdecay_rts.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_fermi_fitting.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_fit_ramsey.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_gate_pinchoff.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_lever_arm_charging_energy.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_ohmic.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_onedot_scan.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_PAT_fitting.ipynb
    - jupyter nbconvert --to notebook --execute docs/notebooks/analysis/example_polFitting.ipynb
    
